# =============================================================================
# API Test Configuration — 撈取真實 API raw data 並驗證 Parser
# =============================================================================
#
# 使用流程：
#   1. 填入下方所有 TODO 欄位（sources / endpoints / targets）
#   2. 設定環境變數 FNA_TOKEN（或寫在 .env）
#   3. make fetch-dry       → 確認 URL 對不對
#   4. make fetch           → 撈取所有 API raw data 存到 test_data/raw/
#   5. make parse           → 把 raw data 餵進 parser，輸出結果報告
#   6. 微調 parser regex（如果有 empty/error 結果）
# =============================================================================


# =============================================================================
# TODO 區：到公司要填的東西都在這裡
# =============================================================================

# ── API 來源（base URL + auth）──
sources:
  FNA:
    base_url: ""                                  # TODO: 填入真實 FNA base URL
    timeout: 30
    auth:
      type: header                                # Authorization: Bearer <token>
      token_env: FNA_TOKEN                        # 從環境變數或 .env 讀取

  DNA:
    base_url: ""                                  # TODO: 填入真實 DNA base URL
    timeout: 30
    auth: null                                    # DNA 不需要認證


# ── API Endpoint 路徑 ──
# 到公司查好真實路徑後填入，支援佔位符 {ip} 和 {device_type}
#
# 兩種格式：
#   字串格式（FNA）— 所有 device_type 共用同一個 endpoint
#     get_gbic_details: "/switch/network/get_gbic_details/{ip}"
#
#   字典格式（DNA）— 每個 device_type 各自的 endpoint
#     get_version:
#       hpe:  "/api/v1/hpe/version/display_version"
#       ios:  "/api/v1/ios/version/show_version"
#       nxos: "/api/v1/nxos/version/show_version"
#
endpoints:
  # FNA（所有廠牌共用同一個 endpoint，FNA 內部自動偵測廠牌）
  get_gbic_details:     "/switch/network/get_gbic_details/{ip}"
  get_channel_group:    "/switch/network/get_channel_group/{ip}"
  get_error_count:      "/switch/network/get_interface_error_count/{ip}"
  get_static_acl:       "/switch/network/get_static_acl/{ip}"
  get_dynamic_acl:      "/switch/network/get_dynamic_acl/{ip}"
  # DNA（每個 device_type 的指令不同，用字典格式分開填）
  get_mac_table:
    hpe:  "/api/v1/hpe/macaddress/display_macaddress"
    ios:  "/api/v1/ios/macaddress/show_mac_address_table"
    nxos: "/api/v1/nxos/macaddress/show_mac_address_table"
  get_fan:
    hpe:  "/api/v1/hpe/environment/display_fan"
    ios:  "/api/v1/ios/environment/show_env_fan"
    nxos: "/api/v1/nxos/environment/show_environment_fan"
  get_power:
    hpe:  "/api/v1/hpe/environment/display_power"
    ios:  "/api/v1/ios/environment/show_env_power"
    nxos: "/api/v1/nxos/environment/show_environment_power"
  get_version:
    hpe:  "/api/v1/hpe/version/display_version"
    ios:  "/api/v1/ios/version/show_version"
    nxos: "/api/v1/nxos/version/show_version"
  get_interface_status:
    hpe:  "/api/v1/hpe/interface/display_interface_brief"
    ios:  "/api/v1/ios/interface/show_interface_status"
    nxos: "/api/v1/nxos/interface/show_interface_status"
  get_uplink_lldp:                                # Uplink LLDP（所有廠牌都有 LLDP）
    hpe:  "/api/v1/hpe/neighbor/display_lldp_neighbor-information_list"
    ios:  "/api/v1/ios/neighbor/show_lldp_neighbors"
    nxos: "/api/v1/nxos/neighbor/show_lldp_neighbors"
  get_uplink_cdp:                                 # Uplink CDP（僅 Cisco IOS/NXOS，HPE 沒有 CDP）
    ios:  "/api/v1/ios/neighbor/show_cdp_neighbors"
    nxos: "/api/v1/nxos/neighbor/show_cdp_neighbors"


# ── 測試目標交換機 ──
# 每種 device_type 至少填一台，用於驗證對應的 parser
targets:
  - ip: ""                                        # TODO: HPE 交換機 IP
    hostname: ""                                  # TODO: HPE hostname
    device_type: hpe

  - ip: ""                                        # TODO: Cisco IOS 交換機 IP
    hostname: ""
    device_type: ios

  - ip: ""                                        # TODO: Cisco NX-OS 交換機 IP
    hostname: ""
    device_type: nxos


# =============================================================================
# API 定義（不需修改，除非要新增/移除 API）
# =============================================================================
# endpoint 欄位引用上方 endpoints 區塊的 key
# parser_command 中 {device_type} 會被替換為 hpe/ios/nxos
# 產生的檔案名：test_data/raw/{name}_{device_type}_{ip}.txt
# =============================================================================

apis:
  # ── FNA APIs（所有 device_type 共用同一個 endpoint）──
  - name: get_gbic_details
    source: FNA
    parser_command: "get_gbic_details_{device_type}_fna"
    description: "光模組 Tx/Rx 功率"

  - name: get_channel_group
    source: FNA
    parser_command: "get_channel_group_{device_type}_fna"
    description: "Port-Channel 狀態及成員"

  - name: get_error_count
    source: FNA
    parser_command: "get_error_count_{device_type}_fna"
    description: "Interface 錯誤計數"

  - name: get_static_acl
    source: FNA
    parser_command: "get_static_acl_{device_type}_fna"
    description: "Static ACL 綁定"

  - name: get_dynamic_acl
    source: FNA
    parser_command: "get_dynamic_acl_{device_type}_fna"
    description: "Dynamic ACL 綁定"

  # ── DNA APIs（需要 device_type）──
  - name: get_mac_table
    source: DNA
    query_params: { hosts: "{ip}" }
    parser_command: "get_mac_table_{device_type}_dna"
    description: "MAC 位址表"

  - name: get_fan
    source: DNA
    query_params: { hosts: "{ip}" }
    parser_command: "get_fan_{device_type}_dna"
    description: "風扇狀態"

  - name: get_power
    source: DNA
    query_params: { hosts: "{ip}" }
    parser_command: "get_power_{device_type}_dna"
    description: "電源供應器狀態"

  - name: get_version
    source: DNA
    query_params: { hosts: "{ip}" }
    parser_command: "get_version_{device_type}_dna"
    description: "韌體版本"

  - name: get_interface_status
    source: DNA
    query_params: { hosts: "{ip}" }
    parser_command: "get_interface_status_{device_type}_dna"
    description: "介面狀態 (link/speed/duplex)"

  - name: get_uplink_lldp
    source: DNA
    query_params: { hosts: "{ip}" }
    parser_command: "get_uplink_lldp_{device_type}_dna"
    description: "Uplink 鄰居拓撲 (LLDP)"

  - name: get_uplink_cdp
    source: DNA
    query_params: { hosts: "{ip}" }
    parser_command: "get_uplink_cdp_{device_type}_dna"
    description: "Uplink 鄰居拓撲 (CDP，僅 Cisco IOS/NXOS)"
    skip_device_types: [hpe]

