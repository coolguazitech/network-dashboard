# =============================================================================
# 指標設定檔
# =============================================================================
# 此檔案定義所有要監控的指標及其評估標準
# =============================================================================

indicators:
  # ===== 光模組監控 =====
  transceiver:
    enabled: true
    title: "光模組 Tx/Rx 功率監控"
    name: transceiver
    object_type: interface  # 最小觀測單位
    data_type: float
    description: "監控光模組的發射/接收功率是否在正常範圍"
    chart_config:
      type: line
      show_legend: true
    observed_fields:
      - name: tx_power
        label: "Tx Power"
        unit: "dBm"
      - name: rx_power
        label: "Rx Power"
        unit: "dBm"
    metrics:
      tx_power:
        type: range
        min_value: -10.0
        max_value: 2.0
        optimal_min: -5.0
        optimal_max: 0.0
        pass_threshold: 0.3
        description: "Tx Power 正常範圍 -10 ~ 2 dBm"
      rx_power:
        type: range
        min_value: -15.0
        max_value: 2.0
        optimal_min: -10.0
        optimal_max: -2.0
        pass_threshold: 0.3
        description: "Rx Power 正常範圍 -15 ~ 2 dBm"

  # ===== 版本監控 (歲修升版驗證) =====
  version:
    enabled: true
    title: "韌體版本監控"
    name: version
    object_type: switch  # 最小觀測單位是 switch
    data_type: string
    description: "驗證設備是否已升級到目標版本"
    chart_config:
      type: gauge  # 用儀表板顯示通過率
    observed_fields:
      - name: version
        label: "目前版本"
    metrics:
      version:
        type: equals
        # expected_value 從 switches.yaml 的 version_expectations 動態取得
        expected_value: ""  # 會被覆寫
        case_sensitive: false
        pass_threshold: 1.0  # 必須完全匹配
        description: "驗證版本是否升級成功"

  # ===== Uplink 連接監控 =====
  uplink:
    enabled: true
    title: "Uplink 連接監控"
    name: uplink
    object_type: switch  # 每台 switch 檢查其 uplinks
    data_type: boolean
    description: "驗證 Uplink 是否連接到正確的鄰居設備"
    chart_config:
      type: table
    observed_fields:
      - name: neighbor_connected
        label: "鄰居連接狀態"
    metrics:
      neighbor_connected:
        type: boolean
        true_values: ["ok", "connected", "up", "true", "yes"]
        pass_threshold: 1.0
        description: "Uplink 必須連接到預期的鄰居"

  # ===== Fan 狀態監控 =====
  fan:
    enabled: true
    title: "風扇狀態監控"
    name: fan
    object_type: switch  # 每台 switch 有多個 fan
    data_type: string
    description: "監控設備風扇是否正常運作"
    chart_config:
      type: table
    observed_fields:
      - name: fan1
        label: "Fan 1"
      - name: fan2
        label: "Fan 2"
      - name: fan3
        label: "Fan 3"
      - name: fan4
        label: "Fan 4"
    metrics:
      fan_status:
        type: boolean
        true_values: ["ok", "normal", "running", "up"]
        pass_threshold: 0.5
        description: "風扇狀態必須為 OK/Normal"

  # ===== CRC 錯誤監控 =====
  crc_error:
    enabled: true
    title: "Interface CRC Error 監控"
    name: crc_error
    object_type: interface
    data_type: integer
    description: "監控介面 CRC 錯誤計數"
    chart_config:
      type: line
    observed_fields:
      - name: crc_errors
        label: "CRC Errors"
      - name: input_errors
        label: "Input Errors"
    metrics:
      crc_errors:
        type: threshold
        threshold: 100
        is_upper_limit: true  # 錯誤數應小於 threshold
        pass_threshold: 0.5
        description: "CRC 錯誤數應小於 100"
      input_errors:
        type: threshold
        threshold: 100
        is_upper_limit: true
        pass_threshold: 0.5
        description: "Input 錯誤數應小於 100"

  # ===== ACL 設定監控 =====
  acl:
    enabled: false  # 預設停用
    title: "ACL 設定監控"
    name: acl
    object_type: acl  # 每條 ACL 規則
    data_type: boolean
    description: "驗證 ACL 設定是否符合標準"
    chart_config:
      type: table
    observed_fields:
      - name: acl_123
        label: "ACL 123"
      - name: acl_124
        label: "ACL 124"
    metrics:
      acl_match:
        type: boolean
        true_values: ["pass", "ok", "matched"]
        pass_threshold: 1.0
        description: "ACL 設定必須符合標準"
