# =============================================================================
# 系統設定檔 (settings.yaml)
# =============================================================================
# 此檔案整合所有可配置的系統參數，方便統一管理
#
# 使用方式：
# 1. 複製此檔案到 config/settings.yaml（如已存在則直接編輯）
# 2. 根據您的環境修改各項參數
# 3. 重啟服務以套用變更
#
# 注意：
# - 環境變數(.env)優先級高於此檔案
# - 部分敏感設定（如密碼）建議使用 .env 檔案
# =============================================================================

# -----------------------------------------------------------------------------
# 資料庫設定
# -----------------------------------------------------------------------------
database:
  host: localhost          # 資料庫主機位址
  port: 3306               # 資料庫端口
  name: network_dashboard  # 資料庫名稱
  user: admin              # 資料庫使用者
  # password: 請在 .env 中設定 DB_PASSWORD

# -----------------------------------------------------------------------------
# 外部 API 設定
# -----------------------------------------------------------------------------
external_api:
  # API 伺服器位址（真實環境請填入實際 GNMS API URL）
  server: "http://localhost:8001"

  # API 請求超時時間（秒）
  timeout: 30

  # 是否使用 Mock API（true = 使用內建模擬資料，false = 連接真實 API）
  use_mock: true

# -----------------------------------------------------------------------------
# Mock 模式設定（USE_MOCK_API=true 時生效）
# -----------------------------------------------------------------------------
mock:
  # Ping 收斂時間（秒）
  #
  # 模擬設備逐漸「修好」上線的行為：
  # - 每個設備有一個隨機的「修好時間」（0 到此值之間）
  # - 在修好時間之前：設備顯示不可達
  # - 在修好時間之後：設備顯示可達（但有 2% 機率暫時失敗）
  #
  # 建議值：
  # - 快速測試：60（1 分鐘內全部收斂）
  # - 一般測試：600（10 分鐘內全部收斂，預設）
  # - 演示用途：1800（30 分鐘內逐漸收斂）
  # - 立即可達：0（所有設備立即可達）
  ping_converge_time: 600

# -----------------------------------------------------------------------------
# 排程設定
# -----------------------------------------------------------------------------
scheduler:
  # 各資料採集任務的間隔（秒）
  intervals:
    # 設備資料採集
    mac_table: 30
    arp_table: 30
    transceiver: 30
    version: 30
    uplink: 30
    fan: 30
    error_count: 30
    power: 30
    port_channel: 30
    ping: 30

    # Client 資料採集
    gnms_ping: 30
    client_collection: 60

    # 維護任務
    cleanup_old_records: 3600  # 1 小時清理一次舊資料

  # 資料保留天數（超過此天數的舊資料會被清理）
  data_retention_days: 7

# -----------------------------------------------------------------------------
# 指標監控設定
# -----------------------------------------------------------------------------
indicators:
  # 光模組監控閾值
  transceiver:
    tx_power:
      min: -10.0   # 最小可接受值 (dBm)
      max: 2.0     # 最大可接受值 (dBm)
      optimal_min: -5.0
      optimal_max: 0.0
    rx_power:
      min: -15.0
      max: 2.0
      optimal_min: -10.0
      optimal_max: -2.0

  # CRC 錯誤監控
  crc_error:
    threshold: 100  # 錯誤數超過此值視為異常

  # Ping 可達性判定
  ping:
    success_rate_threshold: 80.0  # 成功率低於此值視為不可達 (%)

# -----------------------------------------------------------------------------
# 客戶端比較嚴重程度設定
# -----------------------------------------------------------------------------
client_comparison:
  # 重大問題欄位（這些欄位變化表示嚴重問題）
  critical_fields:
    - switch_hostname
    - interface_name
    - link_status
    - ping_reachable
    - acl_passes

  # 警告欄位（這些欄位變化影響效能）
  warning_fields:
    - speed
    - duplex
    - vlan_id

# -----------------------------------------------------------------------------
# 前端顯示設定
# -----------------------------------------------------------------------------
frontend:
  # 表格每頁顯示筆數
  page_size: 20

  # 資料自動刷新間隔（毫秒）
  refresh_interval: 30000

  # 搜尋最大字元數（超過此長度會被截斷）
  search_max_length: 100

# -----------------------------------------------------------------------------
# 應用程式設定
# -----------------------------------------------------------------------------
application:
  name: "Network Dashboard"
  debug: true
  environment: development  # development / production / testing
  api_prefix: "/api/v1"

# =============================================================================
# 設定說明
# =============================================================================
#
# 【如何選擇 mock.ping_converge_time】
#
# 此參數控制 Mock 模式下設備「逐漸上線」的模擬行為：
#
# 範例：ping_converge_time: 600 (10 分鐘)
# - 設備 A 的修好時間 = 120 秒（約 2 分鐘後可達）
# - 設備 B 的修好時間 = 450 秒（約 7.5 分鐘後可達）
# - 設備 C 的修好時間 = 30 秒（約 30 秒後可達）
#
# 每個設備的「修好時間」是用 IP 的 hash 計算的，所以是確定性的：
# - 相同 IP 每次的修好時間都一樣
# - 不同 IP 的修好時間是隨機分佈的
#
# 【驗證收斂行為】
#
# 1. 設定 ping_converge_time: 120（2 分鐘）
# 2. 重啟服務
# 3. 點擊「批量測試可達性」
# 4. 觀察設備逐漸從「不可達」變成「可達」
# 5. 2 分鐘後所有設備應該都可達（除了 2% 的偶發失敗）
#
# =============================================================================
